/**
 * Created by Roadkill on 5/8/15.
 */
!function(){"use strict";function t(t,e){var n=new Promise(function(n,a){if(isNaN(e))return console.log("Error: number of results to offset is not a number"),void a();if(""===t.trim())return alert("Search term cannot be empty"),void a();t=encodeURIComponent(t);var o="jsonp_"+Math.floor(1e5*Math.random()),r="https://api.twitch.tv/kraken/search/streams?q="+t+"&callback="+o+"&offset="+e,i=d(r);i.onerror=a,window[o]=function(t){t._offset=e,n(t),document.getElementsByTagName("head")[0].removeChild(i);try{delete window[o]}catch(a){window[o]=void 0}}});return n}function e(e,a){document.getElementById("loadingInfo").style.display="inline";var o=t(e,a);o.then(function(t){document.getElementById("loadingInfo").style.display="none",n(t)})["catch"](function(){document.getElementById("loadingInfo").style.display="none",document.getElementById("streams").textContent="An error occurred while loading the data."})}function n(t){var e=t._total,n=document.getElementById("streams"),r=document.getElementById("pagination");if(document.getElementById("resultsCount").textContent="Total Results: "+e,0===e)return n.textContent="No results found.",void(r.style.display="none");var i=t._offset,d=i/s===0?1:i/s+1,c=Math.ceil(t._total/s);document.getElementById("currentPage").textContent=d.toString()+"/"+c.toString(),r.style.display="block",r.setAttribute("data-total-results",e),r.setAttribute("data-offset",i);var l=document.createDocumentFragment(),u=t.streams;u.forEach(function(t){var e=a("div","","stream"),n=a("div","","left"),r=a("img");r.src=t.preview.medium,r.style.display="none",r.onload=function(){this.style.display="block"};var i=a("div","","right"),d=a("h2",t.channel.display_name),s=t.game+" - "+t.viewers.toString()+" viewers",c=a("div",s,"gameViewers"),u=a("div",t.channel.status);o(l,o(e,o(n,r),o(i,d,c,u)))}),n.innerHTML="",n.appendChild(l)}function a(t,e,n){var a=document.createElement(t);return"undefined"!=typeof e&&""!==e&&(a.textContent=e),"undefined"!=typeof n&&a.classList.add(n),a}function o(t){var e=Array.prototype.slice.call(arguments,1);return e.forEach(function(e){t.appendChild(e)}),t}function r(t){var n=t.target,a=parseInt(this.getAttribute("data-total-results"),10),o=parseInt(this.getAttribute("data-offset"),10),r=this.getAttribute("data-search-term");"prev"===n.getAttribute("data-action")&&0!==o&&(o-=s,e(r,o)),"next"===n.getAttribute("data-action")&&a>o+s&&(o+=s,e(r,o))}function i(t){t.forEach(function(t){var e=Object.keys(t)[0];window[e]||d(t[e])})}function d(t){var e=document.createElement("script");return e.type="text/javascript",e.src=t,e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),e}var s=10;!function(){i([{Promise:"es6-promise.min.js"}]);var t=document.getElementById("searchForm");t.addEventListener("submit",function(t){var n=document.getElementById("txtSearch").value;document.getElementById("pagination").setAttribute("data-search-term",document.getElementById("txtSearch").value),t.preventDefault(),e(n,0)},!1),document.getElementById("pagination").addEventListener("click",r,!1)}()}();